# Lab 11.1 Password Reset

## 0x00 Basic Knowledge

Password reset bug always occurs when the authentication process does not implement properly.

## 0x01 Go Hack It

Lab site from [zkaq.org][1]

### Index

The index is about to reset the password with the verification code.

![](./imgs/reset.jpg)

### SEMCMS

As shown in the [source code][2], the verfication code is rand(10, 10000).

```php
// 找回密码
if ($Type=="fintpassword"){
    
    $postEmail=test_input($_POST['Email']);
    
  if ($postEmail!==""){ // 判断是否输入邮箱
        
    $sql="select * from sc_user where user_email='".$postEmail."'"; 
    $result=mysql_query($sql); 
    $row = mysql_fetch_array($result,MYSQL_ASSOC); 
    if (mysql_num_rows($result)>0)
        { 
   $fsjs=rand(10,10000);  //邮件认证码 
   $fhurl=str_replace("SEMCMS_Remail.php","",$_POST['furl']);
   $smtpusermail=$smtpemailto;
   $smtptoemail=$postEmail;
   $mailtitle="来自".$_SERVER['SERVER_NAME']."密码找回邮件！";
   $mailcontent="网站管理员你好：<br>你的邮箱是：".$postEmail."<br> 点击<a href='".$fhurl."?umail=".$postEmail."&type=ok' target='_blank'>找回密码</a>"
           . " 或者复制以下链接到浏览器浏览 <br>"
           . "".$fhurl."?umail=".$postEmail."&type=ok <br>认证码：".$fsjs."<br>请妥善保管！";
   
  mysql_query("UPDATE sc_user SET user_rzm='$fsjs' WHERE user_email='".$postEmail."'");
```

### Brute Force

So we can brute force the verfication code to reset password.

![](./imgs/post.jpg)

![](./imgs/setting.jpg)

### FLAG

Succefully log in to the backend with new password.

![](./imgs/flag.jpg)

[1]: https://hack.zkaq.org/?a=battle&f=target&id=6f9b4e51bd03a68c
[2]: https://github.com/source-trace/semcms/blob/master/Include/web_email.php#L34