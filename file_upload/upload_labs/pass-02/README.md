# Pass-02 Content Type Bypass

## 0x00 Lab Overview 

This [lab][1] is maily about to bypass file type code below, which is a white list.

## 0x01 Source Code

```php
$is_upload = false;
$msg = null;
if (isset($_POST['submit'])) {
    if (file_exists($UPLOAD_ADDR)) {
        if (($_FILES['upload_file']['type'] == 'image/jpeg') || ($_FILES['upload_file']['type'] == 'image/png') || ($_FILES['upload_file']['type'] == 'image/gif')) {
            if (move_uploaded_file($_FILES['upload_file']['tmp_name'], $UPLOAD_ADDR . '/' . $_FILES['upload_file']['name'])) {
                $img_path = $UPLOAD_ADDR . $_FILES['upload_file']['name'];
                $is_upload = true;
            }
        } else {
            $msg = '文件类型不正确，请重新上传！';
        }
    } else {
        $msg = $UPLOAD_ADDR.'文件夹不存在,请手工创建！';
    }
}
```

## 0x02 Go Hack It

### Prepare a Webshell

Follow the instruction [here](../../image_webshell).

![](./test.jpg)

### Upload and Catch the Package

![](./imgs/pkg.jpg)

### Modify

Change extension to php, and forward the package.

```
Content-Disposition: form-data; name="upload_file"; filename="test.php"
```

### Uploaded

Successfully uploaded and can check [here][2] to see result.

![](./imgs/upload.jpg)

[1]: http://120.203.13.75:8125/Pass-02/index.php
[2]: http://120.203.13.75:8125/upload/