# Pass-03 Black List Bypass

## 0x00 Lab Overview 

This [lab][1] is maily about to bypass black list.

## 0x01 Source Code

```php
$is_upload = false;
$msg = null;
if (isset($_POST['submit'])) {
    if (file_exists($UPLOAD_ADDR)) {
        $deny_ext = array('.asp','.aspx','.php','.jsp');
        $file_name = trim($_FILES['upload_file']['name']);
        $file_name = deldot($file_name);//删除文件名末尾的点
        $file_ext = strrchr($file_name, '.');
        $file_ext = strtolower($file_ext); //转换为小写
        $file_ext = str_ireplace('::$DATA', '', $file_ext);//去除字符串::$DATA
        $file_ext = trim($file_ext); //收尾去空

        if(!in_array($file_ext, $deny_ext)) {
            if (move_uploaded_file($_FILES['upload_file']['tmp_name'], $UPLOAD_ADDR. '/' . $_FILES['upload_file']['name'])) {
                 $img_path = $UPLOAD_ADDR .'/'. $_FILES['upload_file']['name'];
                 $is_upload = true;
            }
        } else {
            $msg = '不允许上传.asp,.aspx,.php,.jsp后缀文件！';
        }
    } else {
        $msg = $UPLOAD_ADDR . '文件夹不存在,请手工创建！';
    }
}
```

## 0x02 Go Hack It

### Prepare a Webshell

Follow the instruction [here](../../image_webshell).

### Black List Bypass

| Type | Alternative          |
| ---- | -------------------- |
| php  | php3 php4 php5 phtml |
| jsp  | jspx jspf            |
| asp  | asa cer aspx         |
| exe  | exee                 |

Change the extension.

![](./test.phtml)

Successfully uploaded and can check [here][2] to see result.

![](./imgs/upload.jpg)

[1]: http://120.203.13.75:8125/Pass-03/index.php
[2]: http://120.203.13.75:8125/upload/