# Pass-15 exif_imagetype() Bypass

## 0x00 Lab Overview 

This lab is maily about to bypass file type check by image web shell (.jpg, .png, .gif).

## 0x01 Source Code

```php
function isImage($filename){
    //需要开启php_exif模块
    $image_type = exif_imagetype($filename);
    switch ($image_type) {
        case IMAGETYPE_GIF:
            return "gif";
            break;
        case IMAGETYPE_JPEG:
            return "jpg";
            break;
        case IMAGETYPE_PNG:
            return "png";
            break;    
        default:
            return false;
            break;
    }
}

$is_upload = false;
$msg = null;
if(isset($_POST['submit'])){
    $temp_file = $_FILES['upload_file']['tmp_name'];
    $res = isImage($temp_file);
    if(!$res){
        $msg = "文件未知，上传失败！";
    }else{
        $img_path = $UPLOAD_ADDR."/".rand(10, 99).date("YmdHis").".".$res;
        if(move_uploaded_file($temp_file,$img_path)){
            $is_upload = true;
        }
        else{
            $msg = "上传失败";
        }
    }
}
```

## 0x02 Go Hack It

### Prepare a Webshell

Follow the instruction [here](../../image_webshell).

And click the [gen_imghshell.bat](./gen_imghshell.bat) to create all three type of image shell.

### jpg.php

![](./jpg.php)

### png.php

![](./png.php)

### gif.php

![](./gif.php)

Check the results here. And these image shell need to work with php include.

![](./imgs/upload.jpg)
